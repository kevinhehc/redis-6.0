```
一、流程

1、当slave节点启动后或断开重连后，会向master数据库发送SYNC命令。

2、master节点收到SYNC命令后会开始在后台保存快照（即RDB持久化，在主从复制时，会无条件触发RDB），
   并将保存快照期间接收到的命令缓存起来。

3、master节点执行RDB持久化完后，向所有slave节点发送快照RDB文件，并在发送快照期间继续记录被执行的写命。

4、slave节点收到快照文件后丢弃所有旧数据(会清空所有数据)，载入收到的快照。

5、master节点快照发送完毕、slave节点载入快照完毕后，master节点开始向slave节点发送缓冲区中的写命令。

6、master节点完成对快照的载入，开始接收命令请求，并执行来自主数据库缓冲区的写命令。（从数据库初始化完成）

7、master节点每执行一个写命令就会向slave节点发送相同的写命令，slave节点接收并执行收到的写命令。
  （命令传播操作，slave节点初始化完成后的操作）
```

```

二、注意事项

1）从服务器在同步时，会清空所有数据，服务器在与主服务器进行初连接时，数据库中的所有数据都将丢失，替换成主服务器发送的数据。

2）Redis不支持主主复制。

3）主从复制不会阻塞master（不会阻塞master处理客户端请求），因为RDB是异步进行的；相反slave在初次同步数据时会阻塞不能处理客户端读请求。

4）当多个从服务器尝试连接同一个主服务器的时候，就会出现以下两种情况：

    4.1：如果master节点保存快照还未执行，所有从服务器都会接收到相同的快照文件和相同缓冲区写命令。

    4.2：master节点保存快照正已经执行完毕，当主服务器与较早的从服务器完成以上全部步骤之后，
        主服务器会跟新连接的从服务器重新执行RDB保存快照。

5）如果从服务器连接的时机不凑巧的话，进行多次RDB保存快照，会大量消耗主服务器资源（CPU、内存和磁盘I/O资源）。
```